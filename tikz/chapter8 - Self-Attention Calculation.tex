\documentclass[border=1mm]{standalone}
% \usepackage[margin=2.5cm]{geometry}

\usepackage{graphicx,tikz,tikz-layers,amsmath,ifthen,tabularray} 
\usetikzlibrary{decorations.markings,calc,positioning,arrows,shapes.geometric,arrows.meta,matrix}

\colorlet{myred}{red!80!black}
\colorlet{myblue}{blue!80!black}
\colorlet{mybluee}{myblue!80!black}
\colorlet{mygreen}{green!60!black}
\colorlet{myorange}{orange!70!red!60!black}
\colorlet{mydarkred}{red!20!black}
\colorlet{mydarkblue}{blue!40!black}
\colorlet{mydarkgreen}{green!20!black}




\begin{document}

% \resizebox{\textwidth}{!}{
\tikz[font=\small, scale=1, every node/.style={outer sep=0pt, inner sep=0pt}, w/.style={minimum width=#1}, h/.style={minimum height=#1}, s/.style={minimum size=#1}, eu/.style={shorten >=#1}, ed/.style={shorten <=#1}, line join=round]
{
\tikzset{>={Latex[length=1.5mm, width=1.25mm]}}

\node[draw=black!70, thin, w=1cm, h=.5cm, fill=mygreen!20, label={[label distance=2mm, mygreen]above:$X$}] (x1) {};
\draw[step=.25cm, thin, black!70] (x1.south west) grid (x1.north east);

\node[draw=myred!70, thin, w=.75cm, h=1cm, fill=gray!20, right=1.5cm of x1, label={[label distance=2mm, myred]above:$W^{Q}$}] (wq) {};
\draw[step=.25cm, thin, myred!70] (wq.south west) grid (wq.north east);

\node[draw=black!70, thin, w=.75cm, h=.5cm, fill=myred!20, right=1.5cm of wq, label={[label distance=2mm, myred]above:$Q$}] (q) {};
\draw[step=.25cm, thin, black!70] (q.south west) grid (q.north east);

\node[scale=1.5] at ($(x1.east)!.5!(wq.west)$) {$\times$};
\node[scale=1.5] at ($(wq.east)!.5!(q.west)$) {$=$};

\begin{scope}[yshift=-2cm]
\node[draw=black!70, thin, w=1cm, h=.5cm, fill=mygreen!20, label={[label distance=2mm, mygreen]above:$X$}] (x2) {};
\draw[step=.25cm, thin, black!70] (x2.south west) grid (x2.north east);

\node[draw=myblue!70, thin, w=.75cm, h=1cm, fill=gray!20, right=1.5cm of x2, label={[label distance=2mm, myblue]above:$W^{K}$}] (wk) {};
\draw[step=.25cm, thin, myblue!70] (wk.south west) grid (wk.north east);

\node[draw=black!70, thin, w=.75cm, h=.5cm, fill=myblue!20, right=1.5cm of wk, label={[label distance=2mm, myblue]above:$K$}] (k) {};
\draw[step=.25cm, thin, black!70] (k.south west) grid (k.north east);

\node[scale=1.5] at ($(x2.east)!.5!(wk.west)$) {$\times$};
\node[scale=1.5] at ($(wk.east)!.5!(k.west)$) {$=$};
\end{scope}

\begin{scope}[yshift=-4cm]
\node[draw=black!70, thin, w=1cm, h=.5cm, fill=mygreen!20, label={[label distance=2mm, mygreen]above:$X$}] (x2) {};
\draw[step=.25cm, thin, black!70] (x2.south west) grid (x2.north east);

\node[draw=myblue!50!cyan!70, thin, w=.75cm, h=1cm, fill=gray!20, right=1.5cm of x2, label={[label distance=2mm, myblue!50!cyan]above:$W^{V}$}] (wv) {};
\draw[step=.25cm, thin, myblue!50!cyan!70] (wv.south west) grid (wv.north east);

\node[draw=black!70, thin, w=.75cm, h=.5cm, fill=myblue!50!cyan!20, right=1.5cm of wv, label={[label distance=2mm, myblue!50!cyan]above:$V$}] (v) {};
\draw[step=.25cm, thin, black!70] (v.south west) grid (v.north east);

\node[scale=1.5] at ($(x2.east)!.5!(wv.west)$) {$\times$};
\node[scale=1.5] at ($(wv.east)!.5!(v.west)$) {$=$};
\end{scope}

%------
\node[right=1cm of k] (soft) {Softmax $\left( \cfrac{\tikz{
\node[draw=black!70, thin, w=.75cm, h=.5cm, fill=myred!20, right=3.5cm of k, label={[label distance=2mm, myred]above:$Q$}] (q) {};
\draw[step=.25cm, thin, black!70] (q.south west) grid (q.north east);

\node[draw=black!70, thin, h=.75cm, w=.5cm, fill=myblue!20, label={[label distance=2mm, myblue]above:$K^T$}] (kt) at ([xshift=1cm]q.east) {};
\draw[thin, black!70] ($(kt.north west)+(.25,0)$)--($(kt.south west)+(.25,0)$) ($(kt.south west)+(0,0.25)$)--($(kt.south east)+(0,0.25)$) ($(kt.south west)+(0,0.5)$)--($(kt.south east)+(0,0.5)$);
\node[scale=1.5] at ($(q.east)!.3!(kt.west)$) {$\times$};
}}{\large\begin{array}{cc}  \\ \sqrt{d_k}\end{array}} \right)$};

\node[draw=black!70, thin, w=.75cm, h=.5cm, fill=myblue!50!cyan!20, label={[label distance=2mm, myblue!50!cyan]above:$V$}] (v) at ([xshift=.5cm]soft.east) {};
\draw[thin, black!70] ($(v.north west)+(.25,0)$)--($(v.south west)+(.25,0)$) ($(v.north west)+(0.5,0)$)--($(v.south west)+(0.5,0)$) ($(v.west)+(0,0)$)--($(v.east)+(0,0)$);

\node[draw=black!70, thin, w=.75cm, h=.5cm, fill=myred!20, label={[label distance=2mm, myred]above:$Z$}] (kt) at ([xshift=1.5cm]v.east) {};
\draw[thin, black!70] ($(kt.north west)+(.25,0)$)--($(kt.south west)+(.25,0)$) ($(kt.north west)+(0.5,0)$)--($(kt.south west)+(0.5,0)$) ($(kt.west)+(0,0)$)--($(kt.east)+(0,0)$);

\node[scale=1.5] at ($(v.east)!.5!(kt.west)$) {$=$};



}

% }



\end{document}
