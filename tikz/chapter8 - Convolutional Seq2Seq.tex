\documentclass[border=1mm]{standalone}
% \usepackage[margin=2.5cm]{geometry}

\usepackage{graphicx,tikz,tikz-layers} 
\usetikzlibrary{decorations.markings,calc,positioning,arrows,shapes.geometric,arrows.meta,matrix}

\colorlet{myred}{red!80!black}
\colorlet{myblue}{blue!80!black}
\colorlet{mybluee}{myblue!80!black}
\colorlet{mygreen}{green!60!black}
\colorlet{myorange}{orange!70!red!60!black}
\colorlet{mydarkred}{red!20!black}
\colorlet{mydarkblue}{blue!40!black}
\colorlet{mydarkgreen}{green!20!black}


\begin{document}

% \resizebox{\textwidth}{!}{
\tikz[font=\small,scale=1, every node/.style={outer sep=0pt, inner sep=0pt, align=center, fill=white}, w/.style={minimum width=#1},h/.style={minimum height=#1},s/.style={minimum size=#1}, eu/.style={shorten >=#1},ed/.style={shorten <=#1},line join=round]
{
\tikzset{>={Latex[length=1.5mm, width=1.25mm]}}

\matrix (m) [
    matrix of nodes,
    row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
    nodes={
        draw,
        w=.4cm,
        h=.95cm,
        anchor=center,
        align=center
    }
] {
    |[fill=myblue!30]| & |[fill=myblue!30]| & |[fill=myblue!30]| & |[fill=mygreen!30]| \\
    |[fill=myblue!30]| & |[fill=mygreen!30]| & |[fill=mygreen!30]| & |[fill=myblue!30]| \\
    |[fill=mygreen!30]| & |[fill=myblue!30]| & |[fill=myblue!30]| & |[fill=myblue!30]| \\
};


\matrix (tab1) [matrix of nodes, left=2cm of m, yshift=3.5cm,
row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.95cm},
                 ] {
        
        {}\\ {} \\{} \\{} \\ 
};

\matrix (tab2) [matrix of nodes, left=2cm of m, yshift=-4cm,
row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.95cm},
                 ] {
        
        {}\\ {} \\{} \\{} \\ 
};

\matrix (tab3) [matrix of nodes, right=.5cm of tab2,
row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.95cm},
                 ] {
        
        {}\\ {} \\{} \\{} \\ 
};
%------------------------
\matrix (tab4) [matrix of nodes, right=.5cm of m,
row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.95cm},
                 ] {
        
        {}\\ {} \\{} \\
};

\matrix (tab5) [matrix of nodes, 
row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.95cm},
                 ] at (tab4|-tab2) {
        
        {}\\ {} \\{} \\
};
%----------
\matrix (t1) [matrix of nodes, left=2.5cm of tab1, yshift=1.6cm,
    row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.45cm},
                 ] {
        
        {}\\ {} \\
};

\matrix (t2) [matrix of nodes, below=.15cm of t1,
    row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.45cm},
                 ] {
        
        {}\\ {} \\
};

\matrix (t3) [matrix of nodes, below=.15cm of t2,
    row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.45cm},
                 ] {
        
        {}\\ {} \\
};

\matrix (t4) [matrix of nodes, below=.15cm of t3,
    row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.45cm},
                 ] {
        
        {}\\ {} \\
};

\matrix (t6) [matrix of nodes, right=2.5cm of tab4,
    row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.45cm},
                 ] {
        
        {}\\ {} \\
};

\matrix (t5) [matrix of nodes, above=.15cm of t6,
    row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.45cm},
                 ] {
        
        {}\\ {} \\
};

\matrix (t7) [matrix of nodes, below=.15cm of t6,
    row sep=-\pgflinewidth,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.45cm},
                 ] {
        
        {}\\ {} \\
};

%----------------------
\matrix (r1) [matrix of nodes, left=1.5cm of {$(t2)!.5!(t3)$},
row sep=1mm,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.95cm},
                 ] {
        
        {}\\ {} \\{} \\{} \\{} \\{} \\ 
};

\matrix (r2) [matrix of nodes, row sep=1mm,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.95cm},
                 ] at (r1|-tab2) {
        
        {}\\ {} \\{} \\{} \\ 
};

\matrix (r3) [matrix of nodes, row sep=1mm, right=1.3cm of t6,
    column sep=-\pgflinewidth,
                 nodes={draw, w=.4cm, h=.95cm},
                 ]  {
        
        {}\\ {} \\{} \\ 
};


% Arrows and circles
\node[draw, circle, s=.4cm, right=.5cm of t1-1-1] (c1) {};
\draw (c1.140) to[out=-70, in=110, looseness=1.7] (c1.-40);
\node[draw, circle, s=.4cm, right=1.6cm of t1-2-1] (c2) {\large$\times$};

\node[draw, circle, s=.4cm, right=.5cm of t2-1-1] (c3) {};
\draw (c3.140) to[out=-70, in=110, looseness=1.7] (c3.-40);
\node[draw, circle, s=.4cm, right=1.6cm of t2-2-1] (c4) {\large$\times$};

\node[draw, circle, s=.4cm, right=.5cm of t3-1-1] (c5) {};
\draw (c5.140) to[out=-70, in=110, looseness=1.7] (c5.-40);
\node[draw, circle, s=.4cm, right=1.6cm of t3-2-1] (c6) {\large$\times$};

\node[draw, circle, s=.4cm, right=.5cm of t4-1-1] (c7) {};
\draw (c7.140) to[out=-70, in=110, looseness=1.7] (c7.-40);
\node[draw, circle, s=.4cm, right=1.6cm of t4-2-1] (c8) {\large$\times$};
%---
\node[draw, circle, s=.4cm, left=1.6cm of t5-1-1] (c9) {\large$\times$};
\node[draw, circle, s=.4cm, left=.5cm of t5-2-1] (c10) {};
\draw (c10.140) to[out=-70, in=110, looseness=1.7] (c10.-40);

\node[draw, circle, s=.4cm, left=1.6cm of t6-1-1] (c11) {\large$\times$};
\node[draw, circle, s=.4cm, left=.5cm of t6-2-1] (c12) {};
\draw (c12.140) to[out=-70, in=110, looseness=1.7] (c12.-40);

\node[draw, circle, s=.4cm, left=1.6cm of t7-1-1] (c13) {\large$\times$};
\node[draw, circle, s=.4cm, left=.5cm of t7-2-1] (c14) {};
\draw (c14.140) to[out=-70, in=110, looseness=1.7] (c14.-40);

%-----
\node[draw, circle, s=.4cm, right=1cm of tab5] (c15) {};
\node[draw, circle, s=.4cm, above=1mm of tab5-1-1] (c16) {\large$+$};

\node[draw, circle, s=.4cm] (c17) at (m-3-4|-tab3-1-1) {\scriptsize M};
\node[draw, circle, s=.4cm] (c18) at (m-3-3|-tab3-2-1) {\scriptsize M};
\node[draw, circle, s=.4cm] (c19) at (m-3-2|-tab3-3-1) {\scriptsize M};
\node[draw, circle, s=.4cm] (c20) at (m-3-1|-tab3-4-1) {\scriptsize M};

\node[draw, circle, s=.4cm, above=1mm of tab2-1-1] (c21) {\large$+$};

% Arrows
\foreach \x/\y in {1/1,2/2,3/3,4/4,5/5,6/6,7/7}{
    \foreach \z in {1,2}{
        \draw[->] (t\x-\z-1) -- (c\the\numexpr 2*\x-2+\z);
    }
}


%-------------
\foreach \x/\y/\z in {4/17/1,3/18/2,2/19/3,1/20/4}{
    \draw[->] (m-3-\x) -- (c\y);
    \draw[->] (c\y) -- (tab3-\z-1);
}

\foreach \i in {1,2,...,4}
{
\draw[->] (tab3-\i-1)--(tab2-\i-1);
\draw[->, eu=2mm] (tab2-\i-1)--(r2-\i-1.east|-tab2-\i-1);
}

%---
\draw[->] (tab4-1-1)--(m-1-4);
\draw[->] (tab4-2-1)--(m-2-4);
\draw[->] (tab4-3-1)--(m-3-4);

% \foreach 
\draw[->] (tab1-1-1) -| (m-1-4);
\draw[->] (tab1-2-1) -| (m-1-3);
\draw[->] (tab1-3-1) -| (m-1-2);
\draw[->] (tab1-4-1) -| (m-1-1);

\draw[->] (c1) -| (c2);
\draw[->] (c3) -| (c4);
\draw[->] (c5) -| (c6);
\draw[->] (c7) -| (c8);
\draw[->] (c10) -| (c9);
\draw[->] (c12) -| (c11);
\draw[->] (c14) -| (c13);

\draw[->] (tab1-4-1)--(c21);
\draw[->] (tab4-3-1)--(c16);

\draw[->] (r3-3-1) |- (c15);
\draw[->] (c15)--(tab5);
\draw[->] (c15)|-(tab5-1-1);
\draw[->] (c15)|-(tab5-3-1);

\draw[->] (c2) to[] (tab1-1-1.west|-c2);
\draw[->] (c4) to[out=0, in=180] (tab1-1-1.west|-c4);
\draw[->] (c6) --++(.4,0) |- (tab1-3-1.west);
\draw[->] (c8) --++(.4,0) |- (tab1-4-1.west);
%--
\draw[->] (c9) --++(-.4,0) |- (tab4-1-1.east);
\draw[->] (c11) --++(-.4,0) |- (tab4-2-1.east);
\draw[->] (c13) --++(-.4,0) |- (tab4-3-1.east);
%---
\draw[->] ($(tab5-2-1.west)+(-.2,0)$) --++(-.5,0);

%
\begin{scope}[on behind layer]
\node[w=1.35cm, h=1.5cm, anchor=south east] (a) at ($(t4.west)+(.2,-.1)$) {};    
\draw[fill=myblue!15] (a.south west)--(a.south east)--(a.north west)--cycle;

\node[w=1.35cm, h=1.5cm, anchor=south east] (a) at ($(t3.west)+(.2,-.1)$) {};    
\draw[fill=myblue!15] (a.south west)--(a.south east)--(a.north west)--cycle;
\node[w=1.35cm, h=1.5cm, anchor=south east] (a) at ($(t2.west)+(.2,-.1)$) {};    
\draw[fill=myblue!15] (a.south west)--(a.south east)--(a.north west)--cycle;
\node[w=1.35cm, h=1.5cm, anchor=south east] (a) at ($(t1.west)+(.2,-.1)$) {};    
\draw[fill=myblue!40] (a.south west)--(a.south east)--(a.north west)--cycle;

\node[fill=none, w=1.35cm, h=1.5cm, anchor=west] (a) at ($(t7.east)+(-.2,0)$) {}; 
\draw[fill=myblue!15] (a.west)--(a.north east)--(a.south east)--cycle;
\node[fill=none, w=1.35cm, h=1.5cm, anchor=west] (a) at ($(t6.east)+(-.2,0)$) {}; 
\draw[fill=myblue!15] (a.west)--(a.north east)--(a.south east)--cycle;
\node[fill=none, w=1.35cm, h=1.5cm, anchor=west] (a) at ($(t5.east)+(-.2,0)$) {}; 
\draw[fill=myblue!40] (a.west)--(a.north east)--(a.south east)--cycle;
\end{scope}

% Labels
\node[left=2mm of r2-1-1.west] {\rotatebox{-90}{Sie}};
\node[left=2mm of r2-2-1.west] {\footnotesize\rotatebox{-90}{stimmen}};
\node[left=2mm of r2-3-1.west] {\rotatebox{-90}{zu}};
\node[left=2mm of r2-4-1.west] {\rotatebox{-90}{\texttt{</s>}}};
%--
\node[left=2mm of r1-1-1.west] {\rotatebox{-90}{\texttt{<p>}}};
\node[left=2mm of r1-2-1.west] {\footnotesize\rotatebox{-90}{\texttt{<p>}}};
\node[left=2mm of r1-3-1.west] {\rotatebox{-90}{\texttt{<s>}}};
\node[left=2mm of r1-4-1.west] {\rotatebox{-90}{Sie}};
\node[left=2mm of r1-5-1.west] {\footnotesize\rotatebox{-90}{stimmen}};
\node[left=2mm of r1-6-1.west] {\rotatebox{-90}{zu}};
%---
\node[left=2mm of m-2-1.west] {\rotatebox{-90}{Dot products}};
%---
\node[right=2mm of r3-1-1.east] {\rotatebox{-90}{They}};
\node[right=2mm of r3-2-1.east] {\rotatebox{-90}{agree}};
\node[right=2mm of r3-3-1.east] {\rotatebox{-90}{\texttt{</s>}}};
\node[right=2mm of r3-3-1.east, yshift=-1cm] {\rotatebox{-90}{\texttt{<p>}}};
\node[right=2mm of r3-1-1.east, yshift=1cm] {\rotatebox{-90}{\texttt{<p>}}};
%--
\node[above=2cm of r3-1-1.north, xshift=0cm] {\rotatebox{-90}{Embeddings}};
\node[above=2cm of r3-1-1.north, xshift=-.9cm] {\rotatebox{-90}{Convolutions}};
\node[above=2cm of r3-1-1.north, xshift=-2.5cm] {\rotatebox{-90}{Gated}};
\node[above=2cm of r3-1-1.north, xshift=-3cm] {\rotatebox{-90}{Linear}};
\node[above=2cm of r3-1-1.north, xshift=-3.5cm] {\rotatebox{-90}{Units}};
%---
\node[above=2cm of r3-1-1.north, xshift=-5cm] {\rotatebox{-90}{Attention}};
}
% }
\end{document}
